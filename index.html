<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Predicción de potabilidad</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 40px;
        }
        input, button {
            margin: 10px 0;
            padding: 8px;
        }
    </style>
</head>
<body>
    <h1>Formulario de Valores de agua superficial</h1>
    <form id="predict-form">
        <label>Amoniaco:</label><br>
        <input type="number" step="any" id="ammonia_mg_l" required><br>

        <label>Oxígeno Bioquímico Demandado:</label><br>
        <input type="number" step="any" id="biochemical_oxygen_demand_mg_l" required><br>

        <label>Oxígeno Disuelto:</label><br>
        <input type="number" step="any" id="dissolved_oxygen_mg_l" required><br>

        <label>Ortofosfatos:</label><br>
        <input type="number" step="any" id="orthophosphate_mg_l" required><br>

        <label>Ph Ph Unidades:</label><br>
        <input type="number" step="any" id="ph_ph_units" required><br>

        <label>Temperatura:</label><br>
        <input type="number" step="any" id="temperature_cel" required><br>

        <label>Nitrógeno:</label><br>
        <input type="number" step="any" id="nitrogen_mg_l" required><br>

        <label>Nitrato:</label><br>
        <input type="number" step="any" id="nitrate_mg_l" required><br>

        <button type="submit">Predecir</button>
    </form>

    <p id="predict-result"></p>

    <hr>

    <h2>Subir CSV para Reentrenar</h2>
    <form id="retrain-form">
        <p>
            Para reentrenar, sube el archivo a la carpeta `data/` manualmente por ahora,<br>
            y luego haz clic en el botón:
        </p>
        <button type="submit">Reentrenar Modelo</button>
    </form>

    <p id="retrain-result"></p>

    <script>
        document.getElementById('predict-form').addEventListener('submit', function (e) {
            e.preventDefault();
            const feat00 = document.getElementById('ammonia_mg_l').value;
            const feat01 = document.getElementById('biochemical_oxygen_demand_mg_l').value;
            const feat02 = document.getElementById('dissolved_oxygen_mg_l').value;

            const feat03 = document.getElementById('orthophosphate_mg_l').value;
            const feat04 = document.getElementById('ph_ph_units').value;
            const feat05 = document.getElementById('temperature_cel').value;

            const feat06 = document.getElementById('nitrogen_mg_l').value;
            const feat07 = document.getElementById('nitrate_mg_l').value;

            fetch(`/v1/predict?ammonia_mg_l=${feat00}&biochemical_oxygen_demand_mg_l=${feat01}&dissolved_oxygen_mg_l=${feat02}&orthophosphate_mg_l=${feat03}&ph_ph_units=${feat04}&temperature_cel=${feat05}&nitrogen_mg_l=${feat06}&nitrate_mg_l=${feat07}`)
                .then(response => response.json())
                .then(data => {
                    document.getElementById('predict-result').innerText = `Predicción de ventas: ${data.predictions.toFixed(2)}`;
                })
                .catch(error => {
                    document.getElementById('predict-result').innerText = `Error: ${error}`;
                });
        });

        document.getElementById('retrain-form').addEventListener('submit', function (e) {
            e.preventDefault();

            fetch('/v1/retrain')
                .then(response => response.text())
                .then(data => {
                    document.getElementById('retrain-result').innerHTML = data;
                })
                .catch(error => {
                    document.getElementById('retrain-result').innerText = `Error: ${error}`;
                });
        });
    </script>

    <hr>

<h2>Subir nuevo CSV para entrenamiento</h2>
<form id="upload-form" enctype="multipart/form-data">
    <input type="file" id="file-input" name="file" accept=".csv" required>
    <button type="submit">Subir CSV</button>
</form>

<p id="upload-result"></p>

<script>
    document.getElementById('upload-form').addEventListener('submit', function (e) {
        e.preventDefault();
        const formData = new FormData();
        const fileInput = document.getElementById('file-input');

        if (fileInput.files.length === 0) {
            document.getElementById('upload-result').innerText = "Por favor selecciona un archivo CSV.";
            return;
        }

        formData.append('file', fileInput.files[0]);

        fetch('/v1/upload', {
            method: 'POST',
            body: formData
        })
        .then(response => response.text())
        .then(data => {
            document.getElementById('upload-result').innerText = data;
        })
        .catch(error => {
            document.getElementById('upload-result').innerText = `Error: ${error}`;
        });
    });
</script>
</body>
</html>
